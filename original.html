<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Critters Quest</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        #debug-button {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            border: 1px solid #fff;
            border-radius: 5px;
            z-index: 10000;
            font-size: 14px;
            cursor: pointer;
        }
        #error-display {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: #ff3333;
            padding: 10px;
            font-family: monospace;
            z-index: 10000;
            max-width: 90%;
            max-height: 30vh;
            overflow: auto;
            font-size: 12px;
            border-radius: 5px;
            border: 1px solid #ff0000;
            display: none;
        }
    </style>
</head>
<body>
    <div id="error-display"></div>
    <div id="game-container">
        <img src="assets/images/fence.png" alt="fence" class="fence">
    </div>
    <a href="./index.html" id="debug-button">Debug Mode</a>
    
    <script type="module">
        import MobileStartScene from './js/scenes/MobileStartScene.js';
        
        try {
            // Configure the game
            const config = {
                type: Phaser.AUTO,
                width: window.innerWidth,
                height: window.innerHeight,
                backgroundColor: '#000000',
                parent: 'game-container',
                scene: [MobileStartScene],
                scale: {
                    mode: Phaser.Scale.RESIZE,
                    width: '100%',
                    height: '100%'
                },
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 0 },
                        debug: false
                    }
                }
            };
            
            // Create the game instance
            const game = new Phaser.Game(config);
            
            // Add resize handler
            window.addEventListener('resize', () => {
                game.scale.resize(window.innerWidth, window.innerHeight);
                console.log(`Window resized to ${window.innerWidth}x${window.innerHeight}`);
            });
            
            // Add error handler
            window.addEventListener('error', (event) => {
                const errorDisplay = document.getElementById('error-display');
                if (errorDisplay) {
                    errorDisplay.style.display = 'block';
                    errorDisplay.innerHTML = `<strong>Error:</strong> ${event.message}<br>
                                             <strong>File:</strong> ${event.filename}<br>
                                             <strong>Line:</strong> ${event.lineno}:${event.colno}`;
                }
                console.error('Game error:', event);
            });
            
            // Prevent default touch behaviors
            document.addEventListener('touchstart', (e) => {
                if (e.target.tagName !== 'A' && e.target.tagName !== 'BUTTON') {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Log success
            console.log('Game initialized successfully');
            
        } catch (error) {
            console.error('Failed to initialize game:', error);
            const errorDisplay = document.getElementById('error-display');
            if (errorDisplay) {
                errorDisplay.style.display = 'block';
                errorDisplay.innerHTML = `<strong>Initialization Error:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>
